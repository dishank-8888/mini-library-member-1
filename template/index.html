<!-- User Panel -->
<div class="panel">
    <h2>Users</h2>
    <input type="text" id="userName" placeholder="Enter user name">
    <button onclick="addUser()">Add User</button>
    <ul id="userList"></ul>
</div>
<script>
    // User Authentication
async function loginUser() {
    const name = document.getElementById('loginName').value.trim();
    if (!name) return alert('Enter your name');
    await fetch('/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
    });
    checkLogin();
}

async function logoutUser() {
    await fetch('/logout', {method: 'POST'});
    checkLogin();
}

async function checkLogin() {
    const response = await fetch('/session');
    const data = await response.json();
    if (data.logged_in) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('mainSection').style.display = '';
    } else {
        document.getElementById('loginSection').style.display = '';
        document.getElementById('mainSection').style.display = 'none';
    }
}
// User Management
async function addUser() {
    try {
        const res = await fetch('/users', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name})
        });
        if (!res.ok) throw new Error(await res.text());
        fetchUsers();
    } catch (err) {
        alert(Error: ${err.message});
    }



    await fetch('/users', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
    });
    fetchUsers();
}

async function fetchUsers() {
    const res = await fetch('/users');
    const users = await res.json();
    const userList = document.getElementById('userList');
    userList.innerHTML = '';
    users.forEach(u => {
        // In fetchUsers():
users.forEach(u => {
    const li = document.createElement('li');
    li.textContent = u.name;  // Safe text injection
    userList.appendChild(li);
});

    });
}

</script>